{"version":3,"file":"simpleAnimate.js","sources":["../src/Animate/index.ts"],"sourcesContent":["type AnimateFn = (time: number, beginValue: number, changeValue: number, during: number) => number;\n\ntype AnimateType = {\n  [x: string]: AnimateFn;\n};\n\ntype DefaultOpts = {\n  from: number;\n  to: number;\n  during: number;\n  type: string;\n  callback(value: number): void;\n};\n\ntype SimpleAnimate = {\n  animateType: AnimateType;\n  defaultOpts: DefaultOpts;\n  extend(type: string): void;\n  play(options: DefaultOpts): Promise<undefined>;\n};\n\nconst simpleAnimate: SimpleAnimate = {\n  // 暂时只有这几个动画函数算法\n  // 需要增加参考 https://github.com/zhangxinxu/Tween/blob/master/tween.js\n  // t: current time, b: begInnIng value, c: change In value, d: duration\n  animateType: {\n    // 匀速\n    linear(t, b, c, d) {\n      return (c * t) / d + b;\n    },\n    // 先慢后快\n    easeInQuad(t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n    // 先快后慢\n    easeOutQuad(t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    }\n  },\n  defaultOpts: {\n    from: 0,\n    to: 1000,\n    during: 300,\n    type: 'easeInQuad',\n    callback() {}\n  },\n  // 增加动画算法\n  extend(type: string) {\n    this.animateType = Object.assign({}, this.animateType, type);\n  },\n  /*\n    * options 配置\n      {\n        from: 开始值,\n        to: 目标值,\n        during: 持续时间,\n        type: 动画函数\n        callback: 回调\n      }\n      return <Promise>\n  */\n  play(options): Promise<undefined> {\n    return new Promise(resolve => {\n      const opts = Object.assign({}, this.defaultOpts, options);\n      const { to, from, type, during, callback } = opts;\n      // 计算总共的帧数\n      // 1秒 = 60帧\n      // 1帧 = 16.7ms\n      // 根据毫秒数得出总共的帧数\n      const durFps = Math.ceil(during / 16.7);\n      // requestAnimationFrame的兼容处理\n      if (!window.requestAnimationFrame) {\n        window.requestAnimationFrame = fn => window.setTimeout(fn, 16.7);\n      }\n      // 动画运动实际上就是 0 ~ 动画总帧数 的过程\n      let start = 0;\n      // 运动\n      const step = () => {\n        // 当前的运动位置\n        const value = this.animateType[type](start, from, to - from, durFps);\n        callback(value);\n        // 时间递增\n        start++;\n        // 如果还没有运动到位，继续\n        if (start <= durFps) {\n          window.requestAnimationFrame(step);\n        } else {\n          // 动画结束，在promise.then中执行相关操作\n          resolve();\n        }\n      };\n      // 开始执行动画\n      step();\n    });\n  }\n};\n\nexport default simpleAnimate;\n"],"names":[],"mappings":";;;;;;EAqBA,IAAM,aAAa,GAAkB;;;;MAInC,WAAW,EAAE;;UAEX,MAAM,YAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;cACf,OAAO,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;WACxB;;UAED,UAAU,YAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;cACnB,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;WAC7B;;UAED,WAAW,YAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;cACpB,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;WACpC;OACF;MACD,WAAW,EAAE;UACX,IAAI,EAAE,CAAC;UACP,EAAE,EAAE,IAAI;UACR,MAAM,EAAE,GAAG;UACX,IAAI,EAAE,YAAY;UAClB,QAAQ,iBAAK;OACd;;MAED,MAAM,EAAN,UAAO,IAAY;UACjB,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;OAC9D;;;;;;;;;;;;MAYD,IAAI,EAAJ,UAAK,OAAO;UAAZ,iBAiCC;UAhCC,OAAO,IAAI,OAAO,CAAC,UAAA,OAAO;cACxB,IAAM,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,KAAI,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;cAClD,IAAA,EAAE,GAAmC,IAAI,GAAvC,EAAE,IAAI,GAA6B,IAAI,KAAjC,EAAE,IAAI,GAAuB,IAAI,KAA3B,EAAE,MAAM,GAAe,IAAI,OAAnB,EAAE,QAAQ,GAAK,IAAI,SAAT,CAAU;;;;;cAKlD,IAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;;cAExC,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE;kBACjC,MAAM,CAAC,qBAAqB,GAAG,UAAA,EAAE,IAAI,OAAA,MAAM,CAAC,UAAU,CAAC,EAAE,EAAE,IAAI,CAAC,GAAA,CAAC;eAClE;;cAED,IAAI,KAAK,GAAG,CAAC,CAAC;;cAEd,IAAM,IAAI,GAAG;;kBAEX,IAAM,KAAK,GAAG,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC;kBACrE,QAAQ,CAAC,KAAK,CAAC,CAAC;;kBAEhB,KAAK,EAAE,CAAC;;kBAER,IAAI,KAAK,IAAI,MAAM,EAAE;sBACnB,MAAM,CAAC,qBAAqB,CAAC,IAAI,CAAC,CAAC;mBACpC;uBAAM;;sBAEL,OAAO,EAAE,CAAC;mBACX;eACF,CAAC;;cAEF,IAAI,EAAE,CAAC;WACR,CAAC,CAAC;OACJ;GACF,CAAC;;;;;;;;"}